import { OAuth2Scopes } from "discord-api-types/v10";
import {
  ButtonStyle,
  CommandInteraction,
  ComponentType,
  MessageComponentInteraction,
} from "discord.js";
import { COMMIT_SHA, VERSION } from "../index.js";

export default function (i: CommandInteraction) {
  return i.reply({
    embeds: [
      {
        color: 0xffcc00,
        thumbnail: {
          url: i.client.user!.displayAvatarURL({
            size: 128,
          }),
        },
        title: "Experiments",
        description:
          "I'm a small bot made by <@728342296696979526> to explore Discord guild experiments. Type `/` to view my commands.",
        footer: {
          text: `v${VERSION} â€¢ ${COMMIT_SHA.slice(0, 8)}`,
        },
      },
    ],
    components: [
      {
        type: ComponentType.ActionRow,
        components: [
          {
            label: "Source code",
            link: "https://github.com/splatterxl/experiments",
          },
          {
            label: "Privacy policy",
            link: "https://github.com/splatterxl/experiments/blob/main/privacy.md",
          },
          {
            label: "Invite",
            link: i.client.generateInvite({
              scopes: [OAuth2Scopes.ApplicationsCommands],
            }),
          },
        ].map((v) => ({
          type: ComponentType.Button,
          style: ButtonStyle.Link,
          url: v.link,
          label: v.label,
        })),
      },
    ],
  });
}

export async function handleComponent(i: MessageComponentInteraction) {
  i.reply({
    content: `
      **__Disclaimer__**

      The data generated by the bot may not be completely accurate due to the methods we use\
      to generate it. Some rollouts are unavailable to bots, some are spoofed and some have\
      duplicate data which we cannot reliably detect. It is unlikely that you as an end user\
      will come across these inconsistencies, but if you do, do not report them to us as\
      they are not our fault.
    `
      .replace(/\n +/g, "\n")
      .replace(/ +/g, " ")
      .trim(),
    ephemeral: true,
  });
}
